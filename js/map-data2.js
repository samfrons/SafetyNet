
var data = {
    "type": "FeatureCollection",
    "features": [{
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-74.002295, 40.713272]
        },
        "properties": {
            "name": "A Bridge Back, 20 Cardinal Hayes Place, Enter through driveway behind Church,NY, 10007"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-73.999266, 40.714435]
        },
        "properties": {
            "name": "Church of the Transfiguration,Chinatown,29 Mott Street, Basement,NY, 10013 "
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [40.70387, -74.013854]
        },
        "properties": {
            "name": "American Indian Community House, Inc., 11 Broadway, 2nd Floor Boardroom, 10004 "
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [40.709118, -74.002135]
        },
        "properties": {
            "name": "St. Margaret's Residence,49 Fulton Street, 1st Floor Library,10038 "
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-74.012088, 40.709078]
        },
        "properties": {
            "name": "Exchange Views,74 Trinity Place, Basement,NY 10006"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-74.008713, 40.713649]
        },
        "properties": {
            "name": "St. Andrew's Church, Friday Downtown,20 Cardinal Hayes Place,NY 10007 "
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-74.012088, 40.709078]
        },
        "properties": {
            "name": "Gateway, 74 Trinity Place, See Guard for meeting location,NY 10006"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-74.001502, 40.713585]
        },
        "properties": {
            "name": "Passing The Bar,20 Cardinal Hayes Place, Enter thru driveway behind Church,NY 10007 "
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-74.00962, 40.712483]
        },
        "properties": {
            "name": "Saint Peter's Church, S.O.B.E.R.,22 Barclay Street, 10007"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-74.006605, 40.714623]
        },
        "properties": {
            "name": "Saint Peter's Church, S.O.B.E.R.,22 Barclay Street, 10007"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [40.713649, -74.008713]
        },
        "properties": {
            "name": "Saturday Afternoon Discussion, 125 Barclay Street,NY 10007 "
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.0483, 38.89372]
        },
        "properties": {
            "name": "Diplomatic Reception Rooms Museum"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.04024, 38.89483]
        },
        "properties": {
            "name": "National Society of Daughters of American Revolution"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.03274, 38.89428]
        },
        "properties": {
            "name": "National Aquarium of Washington District of Columbia"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.01934, 38.89312]
        },
        "properties": {
            "name": "Newseum"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.00135, 38.89122]
        },
        "properties": {
            "name": "National Museum of African Art"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.03808, 38.90521]
        },
        "properties": {
            "name": "National Geographic Society"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.0383, 38.90622]
        },
        "properties": {
            "name": "B'Nai B'Rith Klutznick Museum"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.04747, 38.91094]
        },
        "properties": {
            "name": "Anderson House Museum"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.04684, 38.9115]
        },
        "properties": {
            "name": "The Phillips Collection"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.0421, 38.91283]
        },
        "properties": {
            "name": "National Museum Of American Jewish Military History"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.03552, 38.91372]
        },
        "properties": {
            "name": "House of the Temple Museum"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.01964, 38.8963]
        },
        "properties": {
            "name": "Marian Koshland Science Museum"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.02168, 38.89664]
        },
        "properties": {
            "name": "National Museum of Crime and Punishment"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.02334, 38.89703]
        },
        "properties": {
            "name": "International Spy Museum"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.02622, 38.8976]
        },
        "properties": {
            "name": "Madame Tussauds"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.02245, 38.89782]
        },
        "properties": {
            "name": "National Portrait Gallery"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.02352, 38.89783]
        },
        "properties": {
            "name": "Smithsonian American Art Museum"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.02941, 38.90011]
        },
        "properties": {
            "name": "National Museum of Women in the Arts"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.02764, 38.90578]
        },
        "properties": {
            "name": "Laogai Museum"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.03108, 38.90789]
        },
        "properties": {
            "name": "Bethune Museum-Archives"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.02469, 38.91733]
        },
        "properties": {
            "name": "Black Fashion Museum"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.00812, 38.89768]
        },
        "properties": {
            "name": "National Postal Museum"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.00828, 38.89774]
        },
        "properties": {
            "name": "National Philatelic and Postal History Museum"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.01469, 38.89872]
        },
        "properties": {
            "name": "Lillian and Albert Small Jewish Museum"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.01941, 38.92233]
        },
        "properties": {
            "name": "Howard University Museum;Moorland Spingarn Research Center"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.08627, 38.93873]
        },
        "properties": {
            "name": "American University Museum"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-77.05261, 38.94363]
        },
        "properties": {
            "name": "Hillwood Museum"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [38.94372, -77.05219, ]
        },
        "properties": {
            "name": "Hillwood Museum"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-73.506605, 42.714623, ]
        },
        "properties": {
            "name": "Rock Creek Park Nature Center and Planetarium"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-75.006605, 41.714623, ]
        },
        "properties": {
            "name": "National Museum of Health and Medicine"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "__type": "GeoPoint",
            "coordinates": [-73.006605, 41.714623, ]
        },
        "properties": {
            "name": "Trolly Car Museum"
        }
    }]
};

function createMaps(searchStr) {

    // clear the old map
    //document.getElementById('mapbox').innerHTML = "";
    var parentNode = document.getElementById('mapbox').parentNode;
    var oldDiv = document.getElementById('mapbox');
    parentNode.removeChild(oldDiv);
    var newDiv = document.createElement('div');
    newDiv.setAttribute('id', 'mapbox');
    parentNode.appendChild(newDiv);

    var newdata = parseData(searchStr);
    // Define a custom icon using the Maki museum icon
    var museumIcon = L.Icon.extend({
        iconUrl: './images/location-icon.png',
        shadowUrl: null,
        iconSize: new L.Point(40, 40),
        shadowSize: null,
        iconAnchor: new L.Point(12, 24),
        popupAnchor: new L.Point(0, -24)
    });

    // Define a geojson data layer
    var geojsonLayer = new L.GeoJSON(newdata, {
        pointToLayer: function(latlng) {
            return new L.Marker(latlng, {
                icon: new museumIcon()
            });
        }
    });

    // Define the map to use from MapBox
    var url = 'http://api.tiles.mapbox.com/v3/mapbox.mapbox-streets.jsonp';

    // Get metadata about the map from MapBox
    wax.tilejson(url, function(tilejson) {

        // Make a new Leaflet map in your container div
        var map = new L.Map('mapbox') // container's id="mapbox"
        // Center the map on New York, NY at zoom 15
        .setView(new L.LatLng(40.714623, -74.006605), 15)

        // Add MapBox Streets as a base layer
        .addLayer(new wax.leaf.connector(tilejson))

        // Add the geojson layer
        .addLayer(geojsonLayer);

        // Display the name property on click
        geojsonLayer.on("featureparse", function(e) {
            if (e.properties && e.properties.name) {
                e.layer.bindPopup(e.properties.name);
            }
        });

        // Populate our geojson layer with data
        geojsonLayer.addGeoJSON(newdata);
    });

}

function parseData(searchStr) {

    var jsonObj = []; //declare array   
    var length = data.features.length;

    var count = 0;
    for (var i = 0; i < length; i++) {
        var name = data.features[i].properties.name;
        if (name.toLowerCase().indexOf(searchStr.toLowerCase()) != -1) {
            jsonObj.push(data.features[i]);
            count++;
        }
    }

    var newdata = {
        "type": "FeatureCollection",
        "features": jsonObj
    };

    return newdata;
} 